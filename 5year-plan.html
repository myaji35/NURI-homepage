<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NuriFarm ê´´ì‚°ì  5ê°œë…„ ì¬íˆ¬ì ì‹œë®¬ë ˆì´ì…˜ | NURI</title>

    <!-- Alpine.js for Navigation Interactions -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <style>
        :root {
            /* Salesforce Lightning Design System Colors */
            --color-brand: #00A1E0;
            --color-brand-dark: #0070D2;
            --color-success: #50C878;
            --color-warning: #FFB75D;
            --color-error: #EA001E;
            --color-background: #F3F2F2;
            --color-background-alt: #FAFAF9;
            --color-border: #DDDBDA;
            --color-text-default: #16325C;
            --color-text-weak: #706E6B;
            --color-text-inverse: #FFFFFF;
            --spacing-xx-small: 0.25rem;
            --spacing-x-small: 0.5rem;
            --spacing-small: 0.75rem;
            --spacing-medium: 1rem;
            --spacing-large: 1.5rem;
            --spacing-x-large: 2rem;
            --spacing-xx-large: 3rem;
            --radius-border: 0.25rem;
            --shadow-card: 0 2px 4px rgba(0,0,0,0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: var(--color-background);
            color: var(--color-text-default);
            line-height: 1.6;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--color-brand-dark) 0%, var(--color-brand) 100%);
            color: white;
            padding: var(--spacing-large) var(--spacing-x-large);
            box-shadow: var(--shadow-card);
        }

        .header h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: var(--spacing-small);
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        /* Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: var(--spacing-x-large);
        }

        /* Control Panel */
        .control-panel {
            background: white;
            border-radius: var(--radius-border);
            box-shadow: var(--shadow-card);
            padding: var(--spacing-x-large);
            margin-bottom: var(--spacing-x-large);
        }

        .control-panel h2 {
            font-size: 1.5rem;
            margin-bottom: var(--spacing-large);
            color: var(--color-brand-dark);
        }

        .slider-group {
            margin-bottom: var(--spacing-large);
        }

        .slider-group label {
            display: block;
            font-weight: 600;
            margin-bottom: var(--spacing-small);
            color: var(--color-text-default);
        }

        .slider-group input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: var(--color-background);
            outline: none;
        }

        .slider-group input[type="range"]::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--color-brand);
            cursor: pointer;
        }

        .slider-value {
            display: inline-block;
            background: var(--color-brand);
            color: white;
            padding: var(--spacing-xx-small) var(--spacing-small);
            border-radius: var(--radius-border);
            font-weight: 600;
            margin-left: var(--spacing-small);
        }

        /* Charts Grid */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: var(--spacing-large);
            margin-bottom: var(--spacing-x-large);
        }

        .chart-card {
            background: white;
            border-radius: var(--radius-border);
            box-shadow: var(--shadow-card);
            padding: var(--spacing-large);
        }

        .chart-card h3 {
            font-size: 1.2rem;
            margin-bottom: var(--spacing-medium);
            color: var(--color-brand-dark);
            border-bottom: 2px solid var(--color-brand);
            padding-bottom: var(--spacing-small);
        }

        /* Timeline */
        .timeline {
            background: white;
            border-radius: var(--radius-border);
            box-shadow: var(--shadow-card);
            padding: var(--spacing-x-large);
            margin-bottom: var(--spacing-x-large);
        }

        .timeline h2 {
            font-size: 1.5rem;
            margin-bottom: var(--spacing-large);
            color: var(--color-brand-dark);
        }

        .year-block {
            border-left: 4px solid var(--color-brand);
            padding-left: var(--spacing-large);
            margin-bottom: var(--spacing-large);
            position: relative;
        }

        .year-block::before {
            content: '';
            position: absolute;
            left: -10px;
            top: 0;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--color-brand);
        }

        .year-block h3 {
            font-size: 1.3rem;
            color: var(--color-brand-dark);
            margin-bottom: var(--spacing-medium);
        }

        .year-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-medium);
            margin-top: var(--spacing-medium);
        }

        .metric-box {
            background: var(--color-background-alt);
            padding: var(--spacing-medium);
            border-radius: var(--radius-border);
            border-left: 3px solid var(--color-success);
        }

        .metric-label {
            font-size: 0.875rem;
            color: var(--color-text-weak);
            margin-bottom: var(--spacing-xx-small);
        }

        .metric-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--color-brand-dark);
        }

        /* Summary Cards */
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--spacing-large);
            margin-bottom: var(--spacing-x-large);
        }

        .summary-card {
            background: white;
            border-radius: var(--radius-border);
            box-shadow: var(--shadow-card);
            padding: var(--spacing-large);
            text-align: center;
            border-top: 4px solid var(--color-brand);
        }

        .summary-card .icon {
            font-size: 3rem;
            margin-bottom: var(--spacing-small);
        }

        .summary-card h3 {
            font-size: 0.875rem;
            color: var(--color-text-weak);
            margin-bottom: var(--spacing-small);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .summary-card .value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--color-brand-dark);
        }

        .summary-card .delta {
            font-size: 0.875rem;
            color: var(--color-success);
            margin-top: var(--spacing-xx-small);
        }

        /* Canvas for Chart.js */
        canvas {
            max-height: 300px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
            .year-metrics {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <h1>
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline-block; vertical-align: middle; margin-right: 0.5rem;">
                <line x1="12" y1="20" x2="12" y2="10"></line>
                <line x1="18" y1="20" x2="18" y2="4"></line>
                <line x1="6" y1="20" x2="6" y2="16"></line>
            </svg>
            NuriFarm ê´´ì‚°ì  5ê°œë…„ ROI ì‹œë®¬ë ˆì´ì…˜
        </h1>
        <p>ì´ˆê¸° íˆ¬ì 23ì–µ (ì¥ì• ì¸ê³ ìš©ê³µë‹¨ 20ì–µ + ê´´ì‚°êµ° 3ì–µ) â†’ ì´ìµê¸ˆ ì¬íˆ¬ì â†’ ROI ë‹¬ì„± ì‹œì  í™•ì¸</p>
        <p style="margin-top: 0.5rem; font-size: 1rem; opacity: 0.9;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline-block; vertical-align: middle; margin-right: 0.25rem;">
                <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
            1ë…„ ë‚´ ì¥ì• ì¸ 40ëª… ì±„ìš© (3ê°œì›” ë‹¨ìœ„ 10ëª…ì”©) | ì´í›„ ì´ìµê¸ˆ ì¬íˆ¬ìë¡œ í•˜ìš°ìŠ¤ ì¦ì„¤
        </p>
    </div>

    <div class="container">
        <!-- Summary Cards -->
        <div class="summary-grid">
            <div class="summary-card">
                <div class="icon">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="12" y1="1" x2="12" y2="23"></line>
                        <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                    </svg>
                </div>
                <h3>ì´ˆê¸° íˆ¬ìê¸ˆ</h3>
                <div class="value">23ì–µì›</div>
                <div class="delta">ì¥ì• ì¸ê³ ìš©ê³µë‹¨ 20ì–µ + ê´´ì‚°êµ° 3ì–µ</div>
            </div>
            <div class="summary-card" style="background: linear-gradient(135deg, #FFB75D 0%, #FF9A3C 100%); color: white;">
                <div class="icon">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"></circle>
                        <polyline points="12 6 12 12 16 14"></polyline>
                    </svg>
                </div>
                <h3 style="color: white;">ROI ë‹¬ì„± ì‹œì </h3>
                <div class="value" id="roiPeriod" style="color: white;">-</div>
                <div class="delta" style="color: rgba(255,255,255,0.9);">íˆ¬ìê¸ˆ íšŒìˆ˜ ì™„ë£Œ</div>
            </div>
            <div class="summary-card">
                <div class="icon">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                        <polyline points="17 6 23 6 23 12"></polyline>
                    </svg>
                </div>
                <h3>2030ë…„ ì›”í‰ê·  ë§¤ì¶œ</h3>
                <div class="value" id="totalRevenue2030">-</div>
                <div class="delta" id="revenueDelta">-</div>
            </div>
            <div class="summary-card">
                <div class="icon">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="9" cy="7" r="4"></circle>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                    </svg>
                </div>
                <h3>ì¥ì• ì¸ ê³ ìš© (1ë…„ ë‚´)</h3>
                <div class="value">40ëª…</div>
                <div class="delta">3ê°œì›” ë‹¨ìœ„ 10ëª…ì”© ì±„ìš©</div>
            </div>
            <div class="summary-card" style="background: linear-gradient(135deg, #50C878 0%, #3DA55F 100%); color: white;">
                <div class="icon">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z"></path>
                        <path d="M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12"></path>
                    </svg>
                </div>
                <h3 style="color: white;">2,000ì…€ ë‹¬ì„± ì‹œì </h3>
                <div class="value" id="cellTarget2000" style="color: white;">-</div>
                <div class="delta" style="color: rgba(255,255,255,0.9);">ëª©í‘œ ë‹¬ì„± ì˜ˆìƒ</div>
            </div>
        </div>

        <!-- Control Panel -->
        <div class="control-panel">
            <h2>
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline-block; vertical-align: middle; margin-right: 0.5rem;">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path d="M12 1v6m0 6v6m5.2-13.2l-4.2 4.2m0 0l-4.2 4.2m0-8.4l4.2 4.2m0 0l4.2 4.2M1 12h6m6 0h6"></path>
                </svg>
                ì‹œë®¬ë ˆì´ì…˜ íŒŒë¼ë¯¸í„° ì¡°ì •
            </h2>

            <div class="slider-group">
                <label>
                    ì¬íˆ¬ì ë¹„ìœ¨ (ì˜ì—…ì´ìµ ëŒ€ë¹„)
                    <span class="slider-value" id="reinvestRateValue">75%</span>
                </label>
                <input type="range" id="reinvestRate" min="50" max="90" value="75" step="5">
            </div>

            <div class="slider-group">
                <label>
                    ë³‘í’€ íŒë§¤ê°€ ìƒìŠ¹ë¥  (ì—°ê°„)
                    <span class="slider-value" id="byungpulPriceGrowthValue">5%</span>
                </label>
                <input type="range" id="byungpulPriceGrowth" min="0" max="15" value="5" step="1">
            </div>

            <div class="slider-group">
                <label>
                    ì—ë„ˆì§€ ë¹„ìš© ì ˆê°ë¥  (AI ìµœì í™”)
                    <span class="slider-value" id="energySavingValue">30%</span>
                </label>
                <input type="range" id="energySaving" min="10" max="50" value="30" step="5">
            </div>

            <div class="slider-group">
                <label>
                    ë™ë‹¹ ì¦ì„¤ íˆ¬ìë¹„
                    <span class="slider-value" id="expansionCostValue">2.5ì–µì›</span>
                </label>
                <input type="range" id="expansionCost" min="200" max="350" value="250" step="10">
            </div>
        </div>

        <!-- Charts -->
        <div class="charts-grid">
            <div class="chart-card">
                <h3>
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline-block; vertical-align: middle; margin-right: 0.5rem;">
                        <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                        <polyline points="17 6 23 6 23 12"></polyline>
                    </svg>
                    ì—°ë„ë³„ ë§¤ì¶œ ì¶”ì´
                </h3>
                <canvas id="revenueChart"></canvas>
            </div>
            <div class="chart-card">
                <h3>ğŸ’µ ì‘ëª©ë³„ ë§¤ì¶œ êµ¬ì„±</h3>
                <canvas id="cropRevenueChart"></canvas>
            </div>
            <div class="chart-card">
                <h3>ğŸ—ï¸ ì‹œì„¤ í™•ì¥ ê³„íš</h3>
                <canvas id="facilityChart"></canvas>
            </div>
            <div class="chart-card">
                <h3>ğŸ‘· ê³ ìš© ì¸ì› ì¦ê°€</h3>
                <canvas id="employmentChart"></canvas>
            </div>
        </div>

        <!-- Timeline -->
        <div class="timeline">
            <h2>ğŸ“… 5ê°œë…„ ìƒì„¸ ë¡œë“œë§µ</h2>
            <div id="timelineContent"></div>
        </div>
    </div>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // ë°ì´í„° ëª¨ë¸
        class NuriFarmSimulation {
            constructor() {
                // ì´ˆê¸° ì„¤ì • (2026ë…„)
                this.baseYear = 2026;
                // ì´ˆê¸° 300ì…€ë¡œ ì‹œì‘ (ì…€ë‹¹ 300ë§Œì›)
                // ì…€ë³„ "ì›”" ë§¤ì¶œ: ë³‘í’€ 35ë§Œì›, ë°”ì§ˆ 30ë§Œì›, ìŒˆ 12ë§Œì›
                this.initialCells = {
                    byungpul: 150,  // 50% (150ì…€)
                    basil: 90,      // 30% (90ì…€)
                    ssam: 60        // 20% (60ì…€)
                };
                this.cellPrices = {
                    byungpul: 350000,  // ì‘ê¸°ë‹¹ 35ë§Œì›
                    basil: 300000,     // ì‘ê¸°ë‹¹ 30ë§Œì›
                    ssam: 120000       // ì‘ê¸°ë‹¹ 12ë§Œì›
                };
                this.harvestPerYear = 12; // ì—° 12ì‘ê¸°
                // ê³ ìš© ê³„íš: 1ë…„ ì´ë‚´ ì¥ì• ì¸ 40ëª… ì±„ìš© ì™„ë£Œ (3ê°œì›” ë‹¨ìœ„)
                // ì¥ì• ì¸: ì „ì› ì¤‘ì¦ (40ëª…)
                // ì‘ì—…ì§€ì›ì¸: 10ëª… (ì •ë¶€ ê¸‰ì—¬ 100% ì§€ì›)
                // ê´€ë¦¬ì§: 5ëª… (ìë¶€ë‹´)
                this.employmentPlan = {
                    // ë¶„ê¸°ë³„ ì¥ì• ì¸ ì±„ìš© (1ë…„ = 4ë¶„ê¸°) - ì´ìµ ë²”ìœ„ ë‚´ ì ì§„ì  ê³ ìš©
                    'Q1': { disabled: 3, workSupporter: 1, manager: 1 },    // 1ë¶„ê¸°: ì†Œê·œëª¨ ì‹œì‘ (5ëª…)
                    'Q2': { disabled: 10, workSupporter: 3, manager: 2 },   // 2ë¶„ê¸°: í‘ì í™•ì¸ í›„ í™•ëŒ€ (15ëª…)
                    'Q3': { disabled: 25, workSupporter: 6, manager: 3 },   // 3ë¶„ê¸°: ì…€ ì¦ì„¤ í›„ í™•ëŒ€ (34ëª…)
                    'Q4': { disabled: 40, workSupporter: 10, manager: 5 },  // 4ë¶„ê¸°: ëª©í‘œ ë‹¬ì„± (55ëª…)
                    // ì´í›„ëŠ” 40ëª… ìœ ì§€
                };

                // ì´ˆê¸° íˆ¬ìê¸ˆ (í•œêµ­ì¥ì• ì¸ê³ ìš©ê³µë‹¨ + ê´´ì‚°êµ°)
                this.initialInvestment = 2_300_000_000; // 23ì–µ ì›
                this.keadSupport = 2_000_000_000;       // í•œêµ­ì¥ì• ì¸ê³ ìš©ê³µë‹¨ 20ì–µ
                this.localGovSupport = 300_000_000;     // ê´´ì‚°êµ° 3ì–µ

                // íŒŒë¼ë¯¸í„° (ìŠ¬ë¼ì´ë”ë¡œ ì¡°ì • ê°€ëŠ¥)
                this.reinvestRate = 0.75; // 5ë…„ì°¨ 2,200ì…€ ë‹¬ì„± ëª©í‘œ
                this.byungpulPriceGrowth = 0.05;
                this.energySaving = 0.30;
                this.costPerCell = 3_000_000; // ì…€ë‹¹ 300ë§Œì›

                // ë¹„ìš© êµ¬ì¡°
                this.variableCostRate = 0.40; // ë§¤ì¶œì˜ 40% (ì¢…ì, ì–‘ì•¡, ì „ë ¥, í¬ì¥)

                // ê¸‰ì—¬ ì²´ê³„ (í•˜ë£¨ 4ì‹œê°„ ê·¼ë¬´ 2êµëŒ€)
                this.disabledMonthlySalary = 1_500_000;   // ì¥ì• ì¸ ì›”ê¸‰ 150ë§Œì› (4ì‹œê°„ ê·¼ë¬´)
                this.workSupporterMonthlySalary = 3_000_000; // ì‘ì—…ì§€ì›ì¸ ì›”ê¸‰ 300ë§Œì› (í’€íƒ€ì„)
                this.managerMonthlySalary = 4_000_000;    // ê´€ë¦¬ì§ ì›”ê¸‰ 400ë§Œì›
                // ê³ ì •ë¹„ëŠ” ì…€ ê°œìˆ˜ì— ë”°ë¼ ë‹¨ê³„ì  ì¦ê°€
                // ~600ì…€: 1,000ë§Œì›, 600~1200ì…€: 1,500ë§Œì›, 1200ì…€~: 2,000ë§Œì›
                this.getFixedCost = (totalCells) => {
                    if (totalCells >= 1200) return 20_000_000;
                    if (totalCells >= 600) return 15_000_000;
                    return 10_000_000;
                };

                // ì •ë¶€ ì§€ì›ê¸ˆ (í•œêµ­ì¥ì• ì¸ê³ ìš©ê³µë‹¨)
                this.disabledSupportSevere = 1_000_000; // ì¤‘ì¦ì¥ì• ì¸ ì›” 100ë§Œì› ì§€ì›
                this.workSupporterSalarySupport = 3_000_000; // ì‘ì—…ì§€ì›ì¸ ê¸‰ì—¬ 100% ì§€ì› (ì›” 300ë§Œì›)
            }

            // íŠ¹ì • ê¸°ê°„ì˜ ë§¤ì¶œ ê³„ì‚° (ë¶„ê¸° ë˜ëŠ” ì—°) - ì…€ ê¸°ë°˜
            calculateRevenue(year, quarter, cellState) {
                const yearIndex = year - this.baseYear;
                const byungpulPrice = this.cellPrices.byungpul * Math.pow(1 + this.byungpulPriceGrowth, yearIndex);

                // ë¶„ê¸°ë³„ ë§¤ì¶œ (ì—° ë§¤ì¶œì˜ 1/4)
                // ì…€ë³„ "ì›”" ë§¤ì¶œì´ë¯€ë¡œ ì—° ë§¤ì¶œ = ì›” ë§¤ì¶œ Ã— 12ê°œì›”
                const monthsInPeriod = quarter ? 3 : 12;

                const byungpulRevenue = cellState.byungpul * byungpulPrice * monthsInPeriod;
                const basilRevenue = cellState.basil * this.cellPrices.basil * monthsInPeriod;
                const ssamRevenue = cellState.ssam * this.cellPrices.ssam * monthsInPeriod;

                return {
                    byungpul: byungpulRevenue,
                    basil: basilRevenue,
                    ssam: ssamRevenue,
                    total: byungpulRevenue + basilRevenue + ssamRevenue
                };
            }

            // 5ê°œë…„ ì‹œë®¬ë ˆì´ì…˜ ì‹¤í–‰ (1ì°¨ë…„ì€ ë¶„ê¸°ë³„, 2~5ì°¨ë…„ì€ ì—°ë³„)
            simulate() {
                const results = [];
                let currentCells = {
                    byungpul: this.initialCells.byungpul,
                    basil: this.initialCells.basil,
                    ssam: this.initialCells.ssam
                };

                // ëˆ„ì  í˜„ê¸ˆ íë¦„ (ROI ê³„ì‚°ìš©)
                let cumulativeCash = this.initialInvestment; // ì´ˆê¸° íˆ¬ìê¸ˆ 20ì–µ
                let totalInvested = this.initialInvestment;  // ì´ íˆ¬ìì•¡
                let totalProfit = 0; // ëˆ„ì  ì˜ì—…ì´ìµ
                let roiAchieved = false;
                let roiYear = null;

                // ========== 1ì°¨ë…„: ì›”ë³„ ì‹œë®¬ë ˆì´ì…˜ (2026ë…„) ==========
                for (let month = 1; month <= 12; month++) {
                    // ê³ ìš© ê³„íš (ì›”ë³„)
                    let employees;
                    if (month <= 3) employees = { disabled: 3, workSupporter: 1, manager: 1 };
                    else if (month <= 6) employees = { disabled: 10, workSupporter: 3, manager: 2 };
                    else if (month <= 9) employees = { disabled: 25, workSupporter: 6, manager: 3 };
                    else employees = { disabled: 40, workSupporter: 10, manager: 5 };

                    // ì›” ë§¤ì¶œ
                    const monthlyRevenue = {
                        byungpul: currentCells.byungpul * this.cellPrices.byungpul,
                        basil: currentCells.basil * this.cellPrices.basil,
                        ssam: currentCells.ssam * this.cellPrices.ssam,
                        total: 0
                    };
                    monthlyRevenue.total = monthlyRevenue.byungpul + monthlyRevenue.basil + monthlyRevenue.ssam;

                    // ì›” ë¹„ìš© ê³„ì‚°
                    const variableCost = monthlyRevenue.total * this.variableCostRate * (1 - this.energySaving);

                    // ì¸ê±´ë¹„ (ì›”)
                    const disabledSalary = employees.disabled * this.disabledMonthlySalary;
                    const workSupporterSalary = employees.workSupporter * this.workSupporterMonthlySalary;
                    const managerSalary = employees.manager * this.managerMonthlySalary;

                    // ì •ë¶€ ì§€ì›ê¸ˆ (ì›”)
                    const disabledSupport = employees.disabled * this.disabledSupportSevere;
                    const workSupporterSupport = employees.workSupporter * this.workSupporterSalarySupport;

                    // ì‹¤ì œ ì¸ê±´ë¹„ ë¶€ë‹´
                    const totalSalary = disabledSalary + workSupporterSalary + managerSalary;
                    const totalSupport = disabledSupport + workSupporterSupport;
                    const netLaborCost = totalSalary - totalSupport;

                    const totalCellsNow = currentCells.byungpul + currentCells.basil + currentCells.ssam;
                    const fixedCost = this.getFixedCost(totalCellsNow);
                    const totalCost = variableCost + netLaborCost + fixedCost;

                    const operatingProfit = monthlyRevenue.total - totalCost;
                    const reinvestAmount = operatingProfit > 0 ? operatingProfit * this.reinvestRate : 0;

                    cumulativeCash += operatingProfit;
                    totalProfit += operatingProfit;

                    // ROI ì²´í¬
                    if (!roiAchieved && totalProfit >= totalInvested) {
                        roiAchieved = true;
                        roiYear = `2026ë…„ ${month}ì›”`;
                    }

                    const totalCells = currentCells.byungpul + currentCells.basil + currentCells.ssam;

                    results.push({
                        year: this.baseYear,
                        month: month,
                        period: `2026ë…„ ${month}ì›”`,
                        revenue: monthlyRevenue,
                        variableCost,
                        laborCost: netLaborCost,
                        governmentSupport: totalSupport,
                        fixedCost,
                        totalCost,
                        operatingProfit,
                        reinvestAmount,
                        cumulativeCash,
                        totalProfit,
                        roiAchieved,
                        cells: { ...currentCells },
                        totalCells,
                        employees: { ...employees, totalEmployees: employees.disabled + employees.workSupporter + employees.manager, regular: employees.workSupporter + employees.manager }
                    });

                    // ì›”ë§ ì¬íˆ¬ìë¡œ ì…€ ì¦ì„¤ (2,200ì…€ ë‹¬ì„± ì „ê¹Œì§€ë§Œ)
                    const currentTotalCells = currentCells.byungpul + currentCells.basil + currentCells.ssam;
                    if (currentTotalCells < 2200) {
                        const newCells = Math.floor(reinvestAmount / this.costPerCell);
                        if (newCells > 0) {
                            // 2,200ì…€ ì´ˆê³¼í•˜ì§€ ì•Šë„ë¡ ì œí•œ
                            const maxNewCells = Math.min(newCells, 2200 - currentTotalCells);

                            currentCells.byungpul += Math.round(maxNewCells * 0.5);
                            currentCells.basil += Math.round(maxNewCells * 0.3);
                            currentCells.ssam += Math.round(maxNewCells * 0.2);

                            const investmentAmount = maxNewCells * this.costPerCell;
                            cumulativeCash -= investmentAmount;
                            totalInvested += investmentAmount;
                        }
                    }
                    // 2,200ì…€ ë‹¬ì„± í›„ì—ëŠ” ì¬íˆ¬ì ì—†ì´ ìˆœì´ìµë§Œ ëˆ„ì 
                }

                // ========== 2~5ì°¨ë…„: ì›”ë³„ ì‹œë®¬ë ˆì´ì…˜ (13~60ê°œì›”) ==========
                for (let month = 13; month <= 60; month++) {
                    const year = this.baseYear + Math.floor((month - 1) / 12);
                    const monthInYear = ((month - 1) % 12) + 1;

                    // ì¥ì• ì¸ 40ëª… ìœ ì§€ (1ì°¨ë…„ ì™„ë£Œ í›„)
                    const employees = { disabled: 40, workSupporter: 10, manager: 5 };

                    // ì›” ë§¤ì¶œ (ë³‘í’€ ê°€ê²© ìƒìŠ¹ ë°˜ì˜)
                    const yearIndex = year - this.baseYear;
                    const byungpulPriceGrowth = Math.pow(1 + this.byungpulPriceGrowth, yearIndex);

                    const monthlyRevenue = {
                        byungpul: currentCells.byungpul * this.cellPrices.byungpul * byungpulPriceGrowth,
                        basil: currentCells.basil * this.cellPrices.basil,
                        ssam: currentCells.ssam * this.cellPrices.ssam,
                        total: 0
                    };
                    monthlyRevenue.total = monthlyRevenue.byungpul + monthlyRevenue.basil + monthlyRevenue.ssam;

                    // ì›” ë¹„ìš© ê³„ì‚°
                    const variableCost = monthlyRevenue.total * this.variableCostRate * (1 - this.energySaving);

                    // ì¸ê±´ë¹„ (ì›”) - í•˜ë£¨ 4ì‹œê°„ ê·¼ë¬´ 2êµëŒ€
                    const disabledSalary = employees.disabled * this.disabledMonthlySalary;
                    const workSupporterSalary = employees.workSupporter * this.workSupporterMonthlySalary;
                    const managerSalary = employees.manager * this.managerMonthlySalary;

                    // ì •ë¶€ ì§€ì›ê¸ˆ (ì›”)
                    const disabledSupport = employees.disabled * this.disabledSupportSevere;
                    const workSupporterSupport = employees.workSupporter * this.workSupporterSalarySupport;

                    // ì‹¤ì œ ì¸ê±´ë¹„ ë¶€ë‹´
                    const totalSalary = disabledSalary + workSupporterSalary + managerSalary;
                    const totalSupport = disabledSupport + workSupporterSupport;
                    const netLaborCost = totalSalary - totalSupport;

                    const totalCellsNow = currentCells.byungpul + currentCells.basil + currentCells.ssam;
                    const fixedCost = this.getFixedCost(totalCellsNow);
                    const totalCost = variableCost + netLaborCost + fixedCost;

                    const operatingProfit = monthlyRevenue.total - totalCost;
                    const reinvestAmount = operatingProfit > 0 ? operatingProfit * this.reinvestRate : 0;

                    cumulativeCash += operatingProfit;
                    totalProfit += operatingProfit;

                    // ROI ì²´í¬
                    if (!roiAchieved && totalProfit >= totalInvested) {
                        roiAchieved = true;
                        roiYear = `${year}ë…„ ${monthInYear}ì›”`;
                    }

                    const totalCells = currentCells.byungpul + currentCells.basil + currentCells.ssam;

                    // ì—°ë§(12ì›”)ì—ë§Œ ê²°ê³¼ ì €ì¥ (íƒ€ì„ë¼ì¸ ê°„ê²°í™”)
                    // ë‹¨, 2,200ì…€ ë‹¬ì„±í•œ ì›”ì€ ë°˜ë“œì‹œ ì €ì¥
                    const is2200Achieved = totalCells >= 2200 && (results.length === 0 || results[results.length - 1].totalCells < 2200);

                    if (monthInYear === 12 || is2200Achieved) {
                        results.push({
                            year: year,
                            month: monthInYear,
                            period: monthInYear === 12 ? `${year}ë…„` : `${year}ë…„ ${monthInYear}ì›”`,
                            revenue: monthlyRevenue,
                            variableCost,
                            laborCost: netLaborCost,
                            governmentSupport: totalSupport,
                            fixedCost,
                            totalCost,
                            operatingProfit,
                            reinvestAmount,
                            cumulativeCash,
                            totalProfit,
                            totalInvested,
                            roiAchieved,
                            roiYear,
                            cells: { ...currentCells },
                            totalCells,
                            employees: { ...employees, totalEmployees: employees.disabled + employees.workSupporter + employees.manager, regular: employees.workSupporter + employees.manager }
                        });
                    }

                    // ì›”ë§ ì¬íˆ¬ìë¡œ ì…€ ì¦ì„¤ (2,200ì…€ ë‹¬ì„± ì „ê¹Œì§€ë§Œ)
                    const currentTotalCells2 = currentCells.byungpul + currentCells.basil + currentCells.ssam;
                    if (currentTotalCells2 < 2200) {
                        const newCells = Math.floor(reinvestAmount / this.costPerCell);
                        if (newCells > 0) {
                            // 2,200ì…€ ì´ˆê³¼í•˜ì§€ ì•Šë„ë¡ ì œí•œ
                            const maxNewCells = Math.min(newCells, 2200 - currentTotalCells2);

                            currentCells.byungpul += Math.round(maxNewCells * 0.5);
                            currentCells.basil += Math.round(maxNewCells * 0.3);
                            currentCells.ssam += Math.round(maxNewCells * 0.2);

                            const investmentAmount = maxNewCells * this.costPerCell;
                            cumulativeCash -= investmentAmount;
                            totalInvested += investmentAmount;
                        }
                    }
                    // 2,200ì…€ ë‹¬ì„± í›„ì—ëŠ” ì¬íˆ¬ì ì—†ì´ ìˆœì´ìµë§Œ ëˆ„ì 
                }

                return results;
            }
        }

        // ì „ì—­ ë³€ìˆ˜
        let simulation = new NuriFarmSimulation();
        let simulationResults = [];
        let charts = {};

        // ì°¨íŠ¸ ì´ˆê¸°í™”
        function initCharts() {
            // ë§¤ì¶œ ì¶”ì´ ì°¨íŠ¸
            const revenueCtx = document.getElementById('revenueChart').getContext('2d');
            charts.revenue = new Chart(revenueCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'ì´ ë§¤ì¶œ',
                        data: [],
                        borderColor: '#00A1E0',
                        backgroundColor: 'rgba(0, 161, 224, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { display: true }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return (value / 100000000).toFixed(1) + 'ì–µ';
                                }
                            }
                        }
                    }
                }
            });

            // ì‘ëª©ë³„ ë§¤ì¶œ êµ¬ì„± (2030ë…„ ê¸°ì¤€)
            const cropCtx = document.getElementById('cropRevenueChart').getContext('2d');
            charts.crop = new Chart(cropCtx, {
                type: 'doughnut',
                data: {
                    labels: ['ë³‘í’€', 'ë°”ì§ˆ', 'ìŒˆì±„ì†Œ'],
                    datasets: [{
                        data: [],
                        backgroundColor: ['#50C878', '#FFB75D', '#00A1E0']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { position: 'bottom' }
                    }
                }
            });

            // ì‹œì„¤ í™•ì¥
            const facilityCtx = document.getElementById('facilityChart').getContext('2d');
            charts.facility = new Chart(facilityCtx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [
                        { label: 'ë³‘í’€', data: [], backgroundColor: '#50C878' },
                        { label: 'ë°”ì§ˆ', data: [], backgroundColor: '#FFB75D' },
                        { label: 'ìŒˆì±„ì†Œ', data: [], backgroundColor: '#00A1E0' }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        x: { stacked: true },
                        y: { stacked: true, beginAtZero: true }
                    }
                }
            });

            // ê³ ìš© ì¸ì›
            const employmentCtx = document.getElementById('employmentChart').getContext('2d');
            charts.employment = new Chart(employmentCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        { label: 'ì¥ì• ì¸', data: [], borderColor: '#50C878', tension: 0.4 },
                        { label: 'ì¼ë°˜ì§ì›', data: [], borderColor: '#00A1E0', tension: 0.4 }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: { y: { beginAtZero: true } }
                }
            });
        }

        // ì‹œë®¬ë ˆì´ì…˜ ì‹¤í–‰ ë° ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        function runSimulation() {
            simulationResults = simulation.simulate();
            updateCharts();
            updateSummary();
            updateTimeline();
        }

        function updateCharts() {
            const periods = simulationResults.map(r => r.period);

            // ë§¤ì¶œ ì¶”ì´
            charts.revenue.data.labels = periods;
            charts.revenue.data.datasets[0].data = simulationResults.map(r => r.revenue.total);
            charts.revenue.update();

            // ì‘ëª©ë³„ ë§¤ì¶œ (2030ë…„)
            const lastYear = simulationResults[simulationResults.length - 1];
            charts.crop.data.datasets[0].data = [lastYear.revenue.byungpul, lastYear.revenue.basil, lastYear.revenue.ssam];
            charts.crop.update();

            // ì‹œì„¤ í™•ì¥ (ì…€ ê°œìˆ˜)
            charts.facility.data.labels = periods;
            charts.facility.data.datasets[0].data = simulationResults.map(r => r.cells.byungpul);
            charts.facility.data.datasets[1].data = simulationResults.map(r => r.cells.basil);
            charts.facility.data.datasets[2].data = simulationResults.map(r => r.cells.ssam);
            charts.facility.update();

            // ê³ ìš© ì¸ì›
            charts.employment.data.labels = periods;
            charts.employment.data.datasets[0].data = simulationResults.map(r => r.employees.disabled);
            charts.employment.data.datasets[1].data = simulationResults.map(r => r.employees.regular);
            charts.employment.update();
        }

        function updateSummary() {
            const lastYear = simulationResults[simulationResults.length - 1];
            const firstYear = simulationResults[0];

            // ROI ë‹¬ì„± ì‹œì  ì°¾ê¸°
            const roiResult = simulationResults.find(r => r.roiAchieved);
            if (roiResult) {
                document.getElementById('roiPeriod').textContent = roiResult.period;
            } else {
                document.getElementById('roiPeriod').textContent = 'ë¯¸ë‹¬ì„±';
            }

            // 2,200ì…€ ë‹¬ì„± ì‹œì  ì°¾ê¸°
            const cell2200Result = simulationResults.find(r => r.totalCells >= 2200);
            if (cell2200Result) {
                document.getElementById('cellTarget2000').textContent = cell2200Result.period;
            } else {
                document.getElementById('cellTarget2000').textContent = 'ë¯¸ë‹¬ì„±';
            }

            // 2030ë…„ ì›”í‰ê·  ë§¤ì¶œ
            document.getElementById('totalRevenue2030').textContent = (lastYear.revenue.total / 100000000).toFixed(1) + 'ì–µì›/ì›”';

            // 1ì°¨ë…„ ì›”í‰ê·  ë§¤ì¶œ ê³„ì‚° (1~12ì›” í‰ê· )
            const firstYearTotal = simulationResults.slice(0, 12).reduce((sum, r) => sum + r.revenue.total, 0);
            const firstYearMonthly = firstYearTotal / 12;
            // 2030ë…„ ì›”ë§¤ì¶œê³¼ 1ì°¨ë…„ ì›”í‰ê·  ë§¤ì¶œ ë¹„êµ
            document.getElementById('revenueDelta').textContent = 'â–² ' + (((lastYear.revenue.total / firstYearMonthly - 1) * 100).toFixed(0)) + '% ì¦ê°€';
        }

        function updateTimeline() {
            const container = document.getElementById('timelineContent');
            container.innerHTML = '';

            simulationResults.forEach((result, index) => {
                const yearBlock = document.createElement('div');
                yearBlock.className = 'year-block';

                const expansion = index > 0 ? result.totalCells - simulationResults[index-1].totalCells : 0;
                const expansionText = expansion > 0 ? `<strong style="color: #50C878;">+${expansion}ì…€ ì¦ì„¤</strong>` : 'ìœ ì§€';

                // ROI ë‹¬ì„± í‘œì‹œ
                const roiText = result.roiAchieved && !simulationResults[index-1]?.roiAchieved
                    ? `<strong style="color: #FFB75D;"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline-block; vertical-align: middle; margin-right: 0.25rem;"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>ROI ë‹¬ì„±!</strong>`
                    : '';

                // ì´ ì…€ ê°œìˆ˜ëŠ” result.totalCells ì‚¬ìš©
                const cellsText = result.totalCells >= 2000 && (!simulationResults[index-1] || simulationResults[index-1].totalCells < 2000)
                    ? `<strong style="color: #50C878;"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline-block; vertical-align: middle; margin-right: 0.25rem;"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>${result.totalCells.toLocaleString()}ê°œ ì…€ (ëª©í‘œ 2,000ê°œ ë‹¬ì„±!)</strong>`
                    : `<strong>${result.totalCells.toLocaleString()}ê°œ ì…€</strong>`;

                yearBlock.innerHTML = `
                    <h3>${result.period} ${roiText}</h3>
                    <p style="margin-bottom: var(--spacing-medium);">
                        ${expansionText} |
                        ${cellsText} (ë³‘í’€ ${result.cells.byungpul}ì…€, ë°”ì§ˆ ${result.cells.basil}ì…€, ìŒˆì±„ì†Œ ${result.cells.ssam}ì…€)
                    </p>
                    <div class="year-metrics">
                        <div class="metric-box">
                            <div class="metric-label">${result.month ? 'ì›”ë§¤ì¶œ' : 'ì›”ë§¤ì¶œ'}</div>
                            <div class="metric-value">${(result.revenue.total / 100000000).toFixed(1)}ì–µ</div>
                        </div>
                        <div class="metric-box">
                            <div class="metric-label">ì •ë¶€ ì§€ì›ê¸ˆ</div>
                            <div class="metric-value" style="color: #00A1E0">${(result.governmentSupport / 100000000).toFixed(1)}ì–µ</div>
                        </div>
                        <div class="metric-box">
                            <div class="metric-label">ì˜ì—…ì´ìµ</div>
                            <div class="metric-value" style="color: ${result.operatingProfit >= 0 ? '#50C878' : '#EA001E'}">${(result.operatingProfit / 100000000).toFixed(1)}ì–µ</div>
                        </div>
                        <div class="metric-box">
                            <div class="metric-label">ëˆ„ì  ì´ìµ</div>
                            <div class="metric-value">${(result.totalProfit / 100000000).toFixed(1)}ì–µ</div>
                        </div>
                        <div class="metric-box">
                            <div class="metric-label">ì¥ì• ì¸ ê³ ìš©</div>
                            <div class="metric-value">${result.employees.disabled}ëª…</div>
                        </div>
                        <div class="metric-box">
                            <div class="metric-label">ì´ ê³ ìš© (2êµëŒ€)</div>
                            <div class="metric-value">${result.employees.totalEmployees || result.employees.disabled + result.employees.workSupporter + result.employees.manager}ëª…</div>
                        </div>
                    </div>
                `;
                container.appendChild(yearBlock);
            });
        }

        // ìŠ¬ë¼ì´ë” ì´ë²¤íŠ¸
        document.getElementById('reinvestRate').addEventListener('input', (e) => {
            const value = e.target.value;
            document.getElementById('reinvestRateValue').textContent = value + '%';
            simulation.reinvestRate = value / 100;
            runSimulation();
        });

        document.getElementById('byungpulPriceGrowth').addEventListener('input', (e) => {
            const value = e.target.value;
            document.getElementById('byungpulPriceGrowthValue').textContent = value + '%';
            simulation.byungpulPriceGrowth = value / 100;
            runSimulation();
        });

        document.getElementById('energySaving').addEventListener('input', (e) => {
            const value = e.target.value;
            document.getElementById('energySavingValue').textContent = value + '%';
            simulation.energySaving = value / 100;
            runSimulation();
        });

        document.getElementById('expansionCost').addEventListener('input', (e) => {
            const value = e.target.value;
            document.getElementById('expansionCostValue').textContent = (value / 100).toFixed(1) + 'ì–µì›';
            simulation.expansionCostPerGreenhouse = value * 1000000;
            runSimulation();
        });

        // ì´ˆê¸° ì‹¤í–‰
        window.addEventListener('load', () => {
            initCharts();
            runSimulation();
        });
    </script>
</body>
</html>
